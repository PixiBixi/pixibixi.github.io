<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 830 1100" width="830" height="1100">
  <defs>
    <marker id="arr" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#546E7A"/>
    </marker>
  </defs>

  <!-- START -->
  <rect x="215" y="18" width="270" height="46" rx="23" fill="#1565C0"/>
  <text x="350" y="41" font-family="sans-serif" font-size="14" font-weight="bold" fill="white" text-anchor="middle" dominant-baseline="middle">DDoS L7 détecté</text>

  <!-- Start → Analyser -->
  <line x1="350" y1="64" x2="350" y2="94" stroke="#546E7A" stroke-width="1.8" marker-end="url(#arr)"/>

  <!-- ANALYSER -->
  <rect x="195" y="95" width="310" height="44" rx="6" fill="#37474F"/>
  <text x="350" y="117" font-family="sans-serif" font-size="13" fill="white" text-anchor="middle" dominant-baseline="middle">Analyser : logs, ss, netstat</text>

  <!-- Analyser → D1 -->
  <line x1="350" y1="139" x2="350" y2="172" stroke="#546E7A" stroke-width="1.8" marker-end="url(#arr)"/>

  <!-- D1 : IPs peu nombreuses ? (center 215) -->
  <polygon points="350,173 490,215 350,257 210,215" fill="#E65100"/>
  <text x="350" y="208" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">IPs sources</text>
  <text x="350" y="224" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">peu nombreuses ?</text>
  <line x1="490" y1="215" x2="568" y2="215" stroke="#546E7A" stroke-width="1.8" marker-end="url(#arr)"/>
  <text x="505" y="207" font-family="sans-serif" font-size="11" fill="#2E7D32" font-weight="bold">OUI</text>
  <rect x="569" y="192" width="240" height="46" rx="6" fill="#2E7D32"/>
  <text x="689" y="208" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">iptables -I INPUT</text>
  <text x="689" y="224" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">-s &lt;IP&gt; -j DROP</text>
  <line x1="350" y1="257" x2="350" y2="292" stroke="#546E7A" stroke-width="1.8" marker-end="url(#arr)"/>
  <text x="358" y="275" font-family="sans-serif" font-size="11" fill="#C62828" font-weight="bold">NON</text>

  <!-- D2 : User-Agent identifiable ? (center 335) -->
  <polygon points="350,293 490,335 350,377 210,335" fill="#E65100"/>
  <text x="350" y="328" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">User-Agent</text>
  <text x="350" y="344" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">identifiable ?</text>
  <line x1="490" y1="335" x2="568" y2="335" stroke="#546E7A" stroke-width="1.8" marker-end="url(#arr)"/>
  <text x="505" y="327" font-family="sans-serif" font-size="11" fill="#2E7D32" font-weight="bold">OUI</text>
  <rect x="569" y="312" width="240" height="46" rx="6" fill="#2E7D32"/>
  <text x="689" y="328" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">Drop UA</text>
  <text x="689" y="344" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">HAProxy / NGINX</text>
  <line x1="350" y1="377" x2="350" y2="412" stroke="#546E7A" stroke-width="1.8" marker-end="url(#arr)"/>
  <text x="358" y="395" font-family="sans-serif" font-size="11" fill="#C62828" font-weight="bold">NON</text>

  <!-- D3 : Pays source suspect ? (center 455) -->
  <polygon points="350,413 490,455 350,497 210,455" fill="#E65100"/>
  <text x="350" y="448" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">Pays source</text>
  <text x="350" y="464" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">suspect ?</text>
  <line x1="490" y1="455" x2="568" y2="455" stroke="#546E7A" stroke-width="1.8" marker-end="url(#arr)"/>
  <text x="505" y="447" font-family="sans-serif" font-size="11" fill="#2E7D32" font-weight="bold">OUI</text>
  <rect x="569" y="432" width="240" height="46" rx="6" fill="#2E7D32"/>
  <text x="689" y="448" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">ipset blocklist pays</text>
  <text x="689" y="464" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">(ipdeny.com)</text>
  <line x1="350" y1="497" x2="350" y2="532" stroke="#546E7A" stroke-width="1.8" marker-end="url(#arr)"/>
  <text x="358" y="515" font-family="sans-serif" font-size="11" fill="#C62828" font-weight="bold">NON</text>

  <!-- D4 : Page ciblée unique ? (center 575) -->
  <polygon points="350,533 490,575 350,617 210,575" fill="#E65100"/>
  <text x="350" y="568" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">Page ciblée</text>
  <text x="350" y="584" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">unique ?</text>
  <line x1="490" y1="575" x2="568" y2="575" stroke="#546E7A" stroke-width="1.8" marker-end="url(#arr)"/>
  <text x="505" y="567" font-family="sans-serif" font-size="11" fill="#2E7D32" font-weight="bold">OUI</text>
  <rect x="569" y="552" width="240" height="46" rx="6" fill="#2E7D32"/>
  <text x="689" y="566" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">Pool FPM dédié</text>
  <text x="689" y="582" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">+ rate limit NGINX</text>
  <line x1="350" y1="617" x2="350" y2="652" stroke="#546E7A" stroke-width="1.8" marker-end="url(#arr)"/>
  <text x="358" y="635" font-family="sans-serif" font-size="11" fill="#C62828" font-weight="bold">NON</text>

  <!-- D5 : HTTP 1.0/1.1 pur ? (center 695) -->
  <polygon points="350,653 490,695 350,737 210,695" fill="#E65100"/>
  <text x="350" y="688" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">Trafic HTTP</text>
  <text x="350" y="704" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">1.0 / 1.1 pur ?</text>
  <line x1="490" y1="695" x2="568" y2="695" stroke="#546E7A" stroke-width="1.8" marker-end="url(#arr)"/>
  <text x="505" y="687" font-family="sans-serif" font-size="11" fill="#2E7D32" font-weight="bold">OUI</text>
  <rect x="569" y="672" width="240" height="46" rx="6" fill="#2E7D32"/>
  <text x="689" y="688" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">Forcer HTTP/2</text>
  <text x="689" y="704" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">rejeter HTTP/1.0</text>
  <line x1="350" y1="737" x2="350" y2="772" stroke="#546E7A" stroke-width="1.8" marker-end="url(#arr)"/>
  <text x="358" y="755" font-family="sans-serif" font-size="11" fill="#C62828" font-weight="bold">NON</text>

  <!-- D6 : TLS < 1.2 ? (center 815) -->
  <polygon points="350,773 490,815 350,857 210,815" fill="#E65100"/>
  <text x="350" y="808" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">TLS</text>
  <text x="350" y="824" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">&lt; 1.2 ?</text>
  <line x1="490" y1="815" x2="568" y2="815" stroke="#546E7A" stroke-width="1.8" marker-end="url(#arr)"/>
  <text x="505" y="807" font-family="sans-serif" font-size="11" fill="#2E7D32" font-weight="bold">OUI</text>
  <rect x="569" y="792" width="240" height="46" rx="6" fill="#2E7D32"/>
  <text x="689" y="808" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">Drop TLS &lt; 1.2</text>
  <text x="689" y="824" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">dans HAProxy</text>
  <line x1="350" y1="857" x2="350" y2="892" stroke="#546E7A" stroke-width="1.8" marker-end="url(#arr)"/>
  <text x="358" y="875" font-family="sans-serif" font-size="11" fill="#C62828" font-weight="bold">NON</text>

  <!-- D7 : Stack saturée ? (center 935) -->
  <polygon points="350,893 490,935 350,977 210,935" fill="#E65100"/>
  <text x="350" y="928" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">Stack applicative</text>
  <text x="350" y="944" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">saturée ?</text>
  <line x1="490" y1="935" x2="568" y2="935" stroke="#546E7A" stroke-width="1.8" marker-end="url(#arr)"/>
  <text x="505" y="927" font-family="sans-serif" font-size="11" fill="#2E7D32" font-weight="bold">OUI</text>
  <rect x="569" y="912" width="240" height="46" rx="6" fill="#6A1B9A"/>
  <text x="689" y="928" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">Tuner timeouts</text>
  <text x="689" y="944" font-family="sans-serif" font-size="12" fill="white" text-anchor="middle" dominant-baseline="auto">+ maxconn stack</text>
  <line x1="350" y1="977" x2="350" y2="1012" stroke="#546E7A" stroke-width="1.8" marker-end="url(#arr)"/>
  <text x="358" y="995" font-family="sans-serif" font-size="11" fill="#C62828" font-weight="bold">NON</text>

  <!-- END -->
  <rect x="215" y="1013" width="270" height="46" rx="23" fill="#1565C0"/>
  <text x="350" y="1036" font-family="sans-serif" font-size="13" font-weight="bold" fill="white" text-anchor="middle" dominant-baseline="middle">Monitorer · itérer</text>

  <!-- Légende -->
  <rect x="20" y="980" width="16" height="16" rx="3" fill="#E65100"/>
  <text x="42" y="992" font-family="sans-serif" font-size="11" fill="#333" dominant-baseline="middle">Décision</text>
  <rect x="20" y="1002" width="16" height="16" rx="3" fill="#2E7D32"/>
  <text x="42" y="1014" font-family="sans-serif" font-size="11" fill="#333" dominant-baseline="middle">Action réseau / HTTP</text>
  <rect x="20" y="1024" width="16" height="16" rx="3" fill="#6A1B9A"/>
  <text x="42" y="1036" font-family="sans-serif" font-size="11" fill="#333" dominant-baseline="middle">Tuning applicatif</text>
</svg>
