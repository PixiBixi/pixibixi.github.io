<!doctype html><html lang=fr class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Installer une stack LEMP sous Linux — NGINX, PHP-FPM et MariaDB en version récente. Configuration et optimisation d'un serveur web performant."><meta name=author content="Jérémy DELGADO"><link href="https://wiki.jdelgado.fr/web/nginx/installation/" rel="canonical"><link href=../fetch_good_ips/ rel=prev><link href=../ipv6_nginx/ rel=next><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.18"><title>Installer son Serveur Web : NGINX, PHP-FPM et MariaDB - Jérémy Wiki</title><link rel=stylesheet href=../../../assets/stylesheets/main.7e37652d.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><link rel="stylesheet" href="../../../assets/external/fonts.googleapis.com/css.49ea35f2.css"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-NHG8VK60NB"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-NHG8VK60NB",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-NHG8VK60NB",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><meta property=og:type content=website><meta property=og:title content="Installer son Serveur Web : NGINX, PHP-FPM et MariaDB - Jérémy Wiki"><meta property=og:description content="Installer une stack LEMP sous Linux — NGINX, PHP-FPM et MariaDB en version récente. Configuration et optimisation d'un serveur web performant."><meta property=og:image content=https://wiki.jdelgado.fr/assets/images/social/web/nginx/installation.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><meta content=https://wiki.jdelgado.fr/web/nginx/installation/ property=og:url><meta name=twitter:card content=summary_large_image><meta name=twitter:title content="Installer son Serveur Web : NGINX, PHP-FPM et MariaDB - Jérémy Wiki"><meta name=twitter:description content="Installer une stack LEMP sous Linux — NGINX, PHP-FPM et MariaDB en version récente. Configuration et optimisation d'un serveur web performant."><meta name=twitter:image content=https://wiki.jdelgado.fr/assets/images/social/web/nginx/installation.png><meta name=google-site-verification content=qZ1L3_oqDstaUZ-aoXa5IGd6A_ZzxunPo6tFJYPv984><link href=../../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style><script src=../../../assets/javascripts/glightbox.min.js></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#installer-son-serveur-web-nginx-php-fpm-et-mariadb class=md-skip> Aller au contenu </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=En-tête> <a href=../../.. title="Jérémy Wiki" class="md-header__button md-logo" aria-label="Jérémy Wiki" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Jérémy Wiki </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Installer son Serveur Web : NGINX, PHP-FPM et MariaDB </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to system preference" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5M7 15a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Rechercher placeholder=Rechercher autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Recherche> <button type=reset class="md-search__icon md-icon" title=Effacer aria-label=Effacer tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initialisation de la recherche </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href="https://github.com/PixiBixi/pixibixi.github.io" title="Aller au dépôt" class="md-source" data-md-component="source"> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Onglets data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Sommaire </a> </li> <li class=md-tabs__item> <a href=../../../automation/ansible/ansible/ class=md-tabs__link> Automation </a> </li> <li class=md-tabs__item> <a href=../../../ci-cd/gitlab/cli/ class=md-tabs__link> Ci cd </a> </li> <li class=md-tabs__item> <a href=../../../cloud/aws/cli/ class=md-tabs__link> Cloud </a> </li> <li class=md-tabs__item> <a href=../../../containers/docker/use_proxy/ class=md-tabs__link> Containers </a> </li> <li class=md-tabs__item> <a href=../../../databases/elasticsearch/log_slow_queries/ class=md-tabs__link> Databases </a> </li> <li class=md-tabs__item> <a href=../../../hardware/hdd/wd/fix_hdd/ class=md-tabs__link> Hardware </a> </li> <li class=md-tabs__item> <a href=../../../hypervisor/esxi/upload_iso_cli/ class=md-tabs__link> Hypervisor </a> </li> <li class=md-tabs__item> <a href=../../../kubernetes/argocd/applicationset/ class=md-tabs__link> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../../linux/advanced/lock_ddos/ class=md-tabs__link> Linux </a> </li> <li class=md-tabs__item> <a href=../../../misc/github_template/ class=md-tabs__link> Misc </a> </li> <li class=md-tabs__item> <a href=../../../monitoring/eztools/ class=md-tabs__link> Monitoring </a> </li> <li class=md-tabs__item> <a href=../../../networking/list_prefix_asn/ class=md-tabs__link> Networking </a> </li> <li class=md-tabs__item> <a href=../../../os/mac/brew/ class=md-tabs__link> Os </a> </li> <li class=md-tabs__item> <a href=../../../selfhost/ajenti/ class=md-tabs__link> Selfhost </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../dns/ class=md-tabs__link> Web </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Jérémy Wiki" class="md-nav__button md-logo" aria-label="Jérémy Wiki" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Jérémy Wiki </label> <div class=md-nav__source> <a href="https://github.com/PixiBixi/pixibixi.github.io" title="Aller au dépôt" class="md-source" data-md-component="source"> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Sommaire </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../automation/ansible/ansible/ class=md-nav__link> <span class=md-ellipsis> Automation </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../ci-cd/gitlab/cli/ class=md-nav__link> <span class=md-ellipsis> Ci cd </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../cloud/aws/cli/ class=md-nav__link> <span class=md-ellipsis> Cloud </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../containers/docker/use_proxy/ class=md-nav__link> <span class=md-ellipsis> Containers </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../databases/elasticsearch/log_slow_queries/ class=md-nav__link> <span class=md-ellipsis> Databases </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../hardware/hdd/wd/fix_hdd/ class=md-nav__link> <span class=md-ellipsis> Hardware </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../hypervisor/esxi/upload_iso_cli/ class=md-nav__link> <span class=md-ellipsis> Hypervisor </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../kubernetes/argocd/applicationset/ class=md-nav__link> <span class=md-ellipsis> Kubernetes </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../linux/advanced/lock_ddos/ class=md-nav__link> <span class=md-ellipsis> Linux </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../misc/github_template/ class=md-nav__link> <span class=md-ellipsis> Misc </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../monitoring/eztools/ class=md-nav__link> <span class=md-ellipsis> Monitoring </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../networking/list_prefix_asn/ class=md-nav__link> <span class=md-ellipsis> Networking </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../os/mac/brew/ class=md-nav__link> <span class=md-ellipsis> Os </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../selfhost/ajenti/ class=md-nav__link> <span class=md-ellipsis> Selfhost </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_16 checked> <label class=md-nav__link for=__nav_16 id=__nav_16_label tabindex> <span class=md-ellipsis> Web </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_16_label aria-expanded=true> <label class=md-nav__title for=__nav_16> <span class="md-nav__icon md-icon"></span> Web </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../dns/ class=md-nav__link> <span class=md-ellipsis> Installer son NS ainsi que son resolveur DNS via BIND9 </span> </a> </li> <li class=md-nav__item> <a href=../../ftp/ class=md-nav__link> <span class=md-ellipsis> Installer son serveur FTP </span> </a> </li> <li class=md-nav__item> <a href=../../mail/ class=md-nav__link> <span class=md-ellipsis> Postfix/Dovecot/DKIM/Postgrey et plus encore </span> </a> </li> <li class=md-nav__item> <a href=../../troubleshooting/ class=md-nav__link> <span class=md-ellipsis> MOZILLA_PKIX_ERROR_REQUIRED_TLS_FEATURE_MISSING </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_16_5> <label class=md-nav__link for=__nav_16_5 id=__nav_16_5_label tabindex> <span class=md-ellipsis> Benchmark </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_16_5_label aria-expanded=false> <label class=md-nav__title for=__nav_16_5> <span class="md-nav__icon md-icon"></span> Benchmark </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../benchmark/benchmark_random_querystring/ class=md-nav__link> <span class=md-ellipsis> Benchmark avec une random query string </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_16_6> <label class=md-nav__link for=__nav_16_6 id=__nav_16_6_label tabindex> <span class=md-ellipsis> Haproxy </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_16_6_label aria-expanded=false> <label class=md-nav__title for=__nav_16_6> <span class="md-nav__icon md-icon"></span> Haproxy </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../haproxy/api/ class=md-nav__link> <span class=md-ellipsis> HAproxy : Utiliser son API </span> </a> </li> <li class=md-nav__item> <a href=../../haproxy/cloudflare/ class=md-nav__link> <span class=md-ellipsis> HAproxy : Obtenir les vraies IPs depuis CloudFlare </span> </a> </li> <li class=md-nav__item> <a href=../../haproxy/keep_real_ip/ class=md-nav__link> <span class=md-ellipsis> Conserver l'IP de son visiteur sur un reverse-proxy </span> </a> </li> <li class=md-nav__item> <a href=../../haproxy/maintenance/ class=md-nav__link> <span class=md-ellipsis> HAproxy : Mettre un node en maintenance </span> </a> </li> <li class=md-nav__item> <a href=../../haproxy/memory_limit/ class=md-nav__link> <span class=md-ellipsis> HAproxy : Comportement d'une limite mémoire </span> </a> </li> <li class=md-nav__item> <a href=../../haproxy/overview/ class=md-nav__link> <span class=md-ellipsis> Reverse proxy: HAproxy </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_16_7> <label class=md-nav__link for=__nav_16_7 id=__nav_16_7_label tabindex> <span class=md-ellipsis> Mail </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_16_7_label aria-expanded=false> <label class=md-nav__title for=__nav_16_7> <span class="md-nav__icon md-icon"></span> Mail </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../mail/exim_manage_dkim/ class=md-nav__link> <span class=md-ellipsis> Configurer DKIM avec Exim </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_16_8 checked> <label class=md-nav__link for=__nav_16_8 id=__nav_16_8_label tabindex> <span class=md-ellipsis> Nginx </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_16_8_label aria-expanded=true> <label class=md-nav__title for=__nav_16_8> <span class="md-nav__icon md-icon"></span> Nginx </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../custom_server_header/ class=md-nav__link> <span class=md-ellipsis> Être encore plus safe en customisant son header Server NGINX </span> </a> </li> <li class=md-nav__item> <a href=../fetch_good_ips/ class=md-nav__link> <span class=md-ellipsis> Obtenir les bonnes IP sur apache derrière un reverse proxy </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Installer son Serveur Web : NGINX, PHP-FPM et MariaDB </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Installer son Serveur Web : NGINX, PHP-FPM et MariaDB </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table des matières"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table des matières </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#preambule class=md-nav__link> <span class=md-ellipsis> Préambule </span> </a> </li> <li class=md-nav__item> <a href=#installer-et-configurer-nginx class=md-nav__link> <span class=md-ellipsis> Installer et configurer NGINX </span> </a> <nav class=md-nav aria-label="Installer et configurer NGINX"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#snippets class=md-nav__link> <span class=md-ellipsis> Snippets </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#installer-et-configurer-php7-fpm class=md-nav__link> <span class=md-ellipsis> Installer et configurer PHP7-FPM </span> </a> </li> <li class=md-nav__item> <a href=#installer-et-configurer-mariadb class=md-nav__link> <span class=md-ellipsis> Installer et configurer MariaDB </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../ipv6_nginx/ class=md-nav__link> <span class=md-ellipsis> Configurer nginx pour utiliser IPv6 </span> </a> </li> <li class=md-nav__item> <a href=../nginx_ssl/ class=md-nav__link> <span class=md-ellipsis> Forcer le SSL sous NGINX </span> </a> </li> <li class=md-nav__item> <a href=../php_custom_version/ class=md-nav__link> <span class=md-ellipsis> Installer une version custom de PHP </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_16_9> <label class=md-nav__link for=__nav_16_9 id=__nav_16_9_label tabindex> <span class=md-ellipsis> Ruby </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_16_9_label aria-expanded=false> <label class=md-nav__title for=__nav_16_9> <span class="md-nav__icon md-icon"></span> Ruby </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ruby/install/ class=md-nav__link> <span class=md-ellipsis> Installer Ruby </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_16_10> <label class=md-nav__link for=__nav_16_10 id=__nav_16_10_label tabindex> <span class=md-ellipsis> Varnish </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_16_10_label aria-expanded=false> <label class=md-nav__title for=__nav_16_10> <span class="md-nav__icon md-icon"></span> Varnish </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../varnish/config/ class=md-nav__link> <span class=md-ellipsis> Config varnish </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_16_11> <label class=md-nav__link for=__nav_16_11 id=__nav_16_11_label tabindex> <span class=md-ellipsis> Wordpress </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_16_11_label aria-expanded=false> <label class=md-nav__title for=__nav_16_11> <span class="md-nav__icon md-icon"></span> Wordpress </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../wordpress/migrate_wordpress_sql/ class=md-nav__link> <span class=md-ellipsis> Requêtes SQL pour migrer son WordPress </span> </a> </li> <li class=md-nav__item> <a href=../../wordpress/tips_sql/ class=md-nav__link> <span class=md-ellipsis> Requêtes SQL afin d'optimiser son site </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <nav class=md-tags> <span class=md-tag>LEMP</span> <span class=md-tag>MariaDB</span> <span class=md-tag>NGINX</span> <span class=md-tag>PHP</span> <span class=md-tag>Web</span> <span class=md-tag>Web Hosting</span> </nav> <h1 id=installer-son-serveur-web-nginx-php-fpm-et-mariadb>Installer son Serveur Web : NGINX, PHP-FPM et MariaDB</h1> <h2 id=preambule>Préambule</h2> <p>Nous allons voir comment installer et configurer correctement NGINX, PHP-FPM et MariaDB. Pour cela, nous allons ajouter des sources afin d'obtenir des versions plus à jour de ces différents logiciels Pour les sources de nginx, il faudra remplacer <em>codename</em> par sa distribution (Wheezy, Jessie...)</p> <table> <thead> <tr> <th><strong>Sites officiels</strong></th> <th><strong>Liens utiles</strong></th> </tr> </thead> <tbody> <tr> <td><a href="http://nginx.com/">NGINX</a></td> <td><a href="http://nginx.org/en/docs/">Doc NGINX</a></td> </tr> <tr> <td><a href="http://php.net/">PHP</a></td> <td><a href="http://php.net/manual/fr/">Manuel PHP</a></td> </tr> <tr> <td><a href="https://mariadb.org/">MariaDB</a></td> <td><a href="https://mariadb.com/kb/en/documentation/">Documentation MariaDB</a> </td> </tr> </tbody> </table> <h2 id=installer-et-configurer-nginx>Installer et configurer NGINX</h2> <p>Tout d'abord, avant de vouloir installer le serveur web NGINX, il faut déjà ajouter une source.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>└─#<span class=w> </span>apt-cache<span class=w> </span>policy<span class=w> </span>nginx
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>nginx:
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=w>  </span>Installé<span class=w> </span>:<span class=w> </span><span class=m>1</span>.14.2-2+deb10u4
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=w>  </span>Candidat<span class=w> </span>:<span class=w> </span><span class=m>1</span>.14.2-2+deb10u4
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=w> </span>Table<span class=w> </span>de<span class=w> </span>version<span class=w> </span>:
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=w>     </span><span class=m>1</span>.14.2-2+deb10u4<span class=w> </span><span class=m>500</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=w>        </span><span class=m>500</span><span class=w> </span>http://deb.debian.org/debian<span class=w> </span>buster/main<span class=w> </span>amd64<span class=w> </span>Packages
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=w>        </span><span class=m>500</span><span class=w> </span>http://security.debian.org/debian-security<span class=w> </span>buster/updates/main<span class=w> </span>amd64<span class=w> </span>Packages
</code></pre></div> <p>Si l'on utilise les repositories de base de Debian Buster, ceux-ci nous installent la version <strong>1.14.2</strong> de NGINX. Actuellement, nous en sommes à la <strong>1.21.2</strong>. C'est pour cela que nous ajoutons des repositories afin d'obtenir une version à jour (Dans notre cas, les repositories du site officiel)</p> <p>Cela nous évite bon nombres de failles, et nous permet également de profiter de toutes les dernières nouveautés.</p> <p>Tout d'abord, on commence par ajouter le depot NGINX à Debian</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>$<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] &#39;</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=s2>http://nginx.org/packages/mainline/debian `lsb_release -cs` nginx&quot;</span><span class=w> </span><span class=err>&#39;</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=w>    </span><span class=p>|</span><span class=w> </span>sudo<span class=w> </span>tee<span class=w> </span>/etc/apt/sources.list.d/nginx.list
</code></pre></div> <p>Il faut également ajouter la <strong>GPG Key</strong> à son Debian, sans quoi il nous affichera que la source n'est pas certifiée</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>$<span class=w> </span>curl<span class=w> </span>https://nginx.org/keys/nginx_signing.key<span class=w> </span><span class=p>|</span><span class=w> </span>gpg<span class=w> </span>--dearmor<span class=w> </span><span class=err>&#39;</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=w>    </span><span class=p>|</span><span class=w> </span>sudo<span class=w> </span>tee<span class=w> </span>/usr/share/keyrings/nginx-archive-keyring.gpg<span class=w> </span>&gt;/dev/null
</code></pre></div> <p>Afin d'être sûr que nous allons utiliser les repository Debian, on ajoute un Pinning :</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=nb>echo</span><span class=w> </span>-e<span class=w> </span><span class=s2>&quot;Package: *\nPin: origin nginx.org\nPin: release o=nginx\nPin-Priority: 900\n&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sudo<span class=w> </span>tee<span class=w> </span>/etc/apt/preferences.d/99nginx
</code></pre></div> <p>Et enfin, on effectue un <code>apt-get update</code> pour mettre à jour nos packets disponibles.</p> <p>Si tout marche bien, voici ce que nous devrions obtenir lorsque l'on fait la commande <code>apt-cache policy nginx</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=w>    </span>└─#<span class=w> </span>apt-cache<span class=w> </span>policy<span class=w> </span>nginx
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=w>    </span>nginx:
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=w>      </span>Installé<span class=w> </span>:<span class=w> </span><span class=o>(</span>aucun<span class=o>)</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=w>      </span>Candidat<span class=w> </span>:<span class=w> </span><span class=m>1</span>.21.1-1~buster
</code></pre></div> <p>Si tout se passe comme il faut, on peut lancer l'installation</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>└─#<span class=w> </span>apt-get<span class=w> </span>-y<span class=w> </span>install<span class=w> </span>nginx<span class=w> </span>nginx-extras<span class=w> </span>nginx-doc
</code></pre></div> <p>Voici les options de compilations du paquet <strong>nginx</strong></p> <details class=note> <summary>NGINX Default Compilation Options</summary> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>--prefix<span class=o>=</span>/etc/nginx
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>--sbin-path<span class=o>=</span>/usr/sbin/nginx
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>--conf-path<span class=o>=</span>/etc/nginx/nginx.conf
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>--error-log-path<span class=o>=</span>/var/log/nginx/error.log
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>--http-log-path<span class=o>=</span>/var/log/nginx/access.log
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>--pid-path<span class=o>=</span>/var/run/nginx.pid
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>--lock-path<span class=o>=</span>/var/run/nginx.lock
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a>--http-client-body-temp-path<span class=o>=</span>/var/cache/nginx/client_temp
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>--http-proxy-temp-path<span class=o>=</span>/var/cache/nginx/proxy_temp
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a>--http-fastcgi-temp-path<span class=o>=</span>/var/cache/nginx/fastcgi_temp
<a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a>--http-uwsgi-temp-path<span class=o>=</span>/var/cache/nginx/uwsgi_temp
<a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a>--http-scgi-temp-path<span class=o>=</span>/var/cache/nginx/scgi_temp
<a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a>--user<span class=o>=</span>nginx
<a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a>--group<span class=o>=</span>nginx
<a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a>--with-http_ssl_module<span class=w> </span>--with-http_realip_module<span class=w> </span>--with-http_addition_module<span class=w> </span>--with-http_sub_module
<a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a>--with-http_dav_module<span class=w> </span>--with-http_flv_module<span class=w> </span>--with-http_mp4_module<span class=w> </span>--with-http_gunzip_module
<a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a>--with-http_gzip_static_module<span class=w> </span>--with-http_random_index_module<span class=w> </span>--with-http_secure_link_module<span class=w> </span>--with-http_stub_status_module
<a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a>--with-http_auth_request_module
<a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a>--with-mail
<a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a>--with-mail_ssl_module
<a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a>--with-file-aio
<a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a>--with-http_v2_module
<a id=__codelineno-6-23 name=__codelineno-6-23 href=#__codelineno-6-23></a>--with-ipv6
</code></pre></div> </details> <p>Désormais, nginx est quasiment prêt à être utilisé, il nous reste plus qu'à le configurer.</p> <p>Voici ma configuration personnel que j'utilise</p> <!-- markdownlint-disable --> <details class=example> <summary>File: /etc/nginx/nginx.conf</summary> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=k>user</span><span class=w> </span><span class=s>www-data</span><span class=p>;</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=k>worker_processes</span><span class=w> </span><span class=s>auto</span><span class=p>;</span>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=k>worker_rlimit_nofile</span><span class=w> </span><span class=mi>65536</span><span class=p>;</span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=c1>#worker_cpu_affinity 00000010 00000100 00001000 00010000;</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=k>pid</span><span class=w> </span><span class=s>/run/nginx.pid</span><span class=p>;</span>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=k>include</span><span class=w> </span><span class=n>/etc/nginx/modules-enabled/*.conf</span>;
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=k>events</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=w>    </span><span class=kn>worker_connections</span><span class=w> </span><span class=mi>16384</span><span class=p>;</span>
<a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=w>    </span><span class=c1># multi_accept on;</span>
<a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=p>}</span>
<a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a>
<a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a><span class=k>http</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a>
<a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a><span class=w>    </span><span class=c1>##</span>
<a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a><span class=w>    </span><span class=c1># Basic Settings</span>
<a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a><span class=w>    </span><span class=c1>##</span>
<a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a>
<a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a><span class=w>    </span><span class=kn>sendfile</span><span class=w> </span><span class=no>on</span><span class=p>;</span>
<a id=__codelineno-7-21 name=__codelineno-7-21 href=#__codelineno-7-21></a><span class=w>    </span><span class=kn>tcp_nopush</span><span class=w> </span><span class=no>on</span><span class=p>;</span>
<a id=__codelineno-7-22 name=__codelineno-7-22 href=#__codelineno-7-22></a><span class=w>    </span><span class=kn>tcp_nodelay</span><span class=w> </span><span class=no>on</span><span class=p>;</span>
<a id=__codelineno-7-23 name=__codelineno-7-23 href=#__codelineno-7-23></a>
<a id=__codelineno-7-24 name=__codelineno-7-24 href=#__codelineno-7-24></a><span class=w>    </span><span class=kn>resolver</span><span class=w> </span><span class=mi>127</span><span class=s>.0.0.1</span><span class=w> </span><span class=mi>1</span><span class=s>.1.1.1</span><span class=p>;</span>
<a id=__codelineno-7-25 name=__codelineno-7-25 href=#__codelineno-7-25></a><span class=w>    </span><span class=kn>ignore_invalid_headers</span><span class=w> </span><span class=no>on</span><span class=p>;</span>
<a id=__codelineno-7-26 name=__codelineno-7-26 href=#__codelineno-7-26></a>
<a id=__codelineno-7-27 name=__codelineno-7-27 href=#__codelineno-7-27></a><span class=w>    </span><span class=kn>keepalive_timeout</span><span class=w> </span><span class=mi>65</span><span class=p>;</span>
<a id=__codelineno-7-28 name=__codelineno-7-28 href=#__codelineno-7-28></a><span class=w>    </span><span class=kn>types_hash_max_size</span><span class=w> </span><span class=mi>2048</span><span class=p>;</span>
<a id=__codelineno-7-29 name=__codelineno-7-29 href=#__codelineno-7-29></a>
<a id=__codelineno-7-30 name=__codelineno-7-30 href=#__codelineno-7-30></a><span class=w>    </span><span class=kn>server_tokens</span><span class=w> </span><span class=no>off</span><span class=p>;</span>
<a id=__codelineno-7-31 name=__codelineno-7-31 href=#__codelineno-7-31></a><span class=w>    </span><span class=kn>more_set_headers</span><span class=w> </span><span class=s>Server:</span><span class=w> </span><span class=s>Jeremy</span><span class=w> </span><span class=s>Server</span><span class=p>;</span>
<a id=__codelineno-7-32 name=__codelineno-7-32 href=#__codelineno-7-32></a><span class=w>    </span><span class=kn>more_set_headers</span><span class=w> </span><span class=s>Contact:</span><span class=w> </span><span class=s>wiki[at]jdelgado[dot]fr</span><span class=p>;</span>
<a id=__codelineno-7-33 name=__codelineno-7-33 href=#__codelineno-7-33></a>
<a id=__codelineno-7-34 name=__codelineno-7-34 href=#__codelineno-7-34></a><span class=w>    </span><span class=c1># server_names_hash_bucket_size 64;</span>
<a id=__codelineno-7-35 name=__codelineno-7-35 href=#__codelineno-7-35></a><span class=w>    </span><span class=c1># server_name_in_redirect off;</span>
<a id=__codelineno-7-36 name=__codelineno-7-36 href=#__codelineno-7-36></a>
<a id=__codelineno-7-37 name=__codelineno-7-37 href=#__codelineno-7-37></a><span class=w>    </span><span class=kn>include</span><span class=w> </span><span class=s>/etc/nginx/mime.types</span><span class=p>;</span>
<a id=__codelineno-7-38 name=__codelineno-7-38 href=#__codelineno-7-38></a><span class=w>    </span><span class=kn>default_type</span><span class=w> </span><span class=s>application/octet-stream</span><span class=p>;</span>
<a id=__codelineno-7-39 name=__codelineno-7-39 href=#__codelineno-7-39></a>
<a id=__codelineno-7-40 name=__codelineno-7-40 href=#__codelineno-7-40></a><span class=w>    </span><span class=c1>##</span>
<a id=__codelineno-7-41 name=__codelineno-7-41 href=#__codelineno-7-41></a><span class=w>    </span><span class=c1># SSL Settings</span>
<a id=__codelineno-7-42 name=__codelineno-7-42 href=#__codelineno-7-42></a><span class=w>    </span><span class=c1>##</span>
<a id=__codelineno-7-43 name=__codelineno-7-43 href=#__codelineno-7-43></a>
<a id=__codelineno-7-44 name=__codelineno-7-44 href=#__codelineno-7-44></a><span class=w>    </span><span class=kn>ssl_protocols</span><span class=w> </span><span class=s>TLSv1</span><span class=w> </span><span class=s>TLSv1.1</span><span class=w> </span><span class=s>TLSv1.2</span><span class=w> </span><span class=s>TLSv1.3</span><span class=p>;</span><span class=w> </span><span class=c1># Dropping SSLv3, ref: POODLE</span>
<a id=__codelineno-7-45 name=__codelineno-7-45 href=#__codelineno-7-45></a><span class=w>    </span><span class=kn>ssl_prefer_server_ciphers</span><span class=w> </span><span class=no>on</span><span class=p>;</span>
<a id=__codelineno-7-46 name=__codelineno-7-46 href=#__codelineno-7-46></a>
<a id=__codelineno-7-47 name=__codelineno-7-47 href=#__codelineno-7-47></a><span class=w>    </span><span class=c1>##</span>
<a id=__codelineno-7-48 name=__codelineno-7-48 href=#__codelineno-7-48></a><span class=w>    </span><span class=c1># Logging Settings</span>
<a id=__codelineno-7-49 name=__codelineno-7-49 href=#__codelineno-7-49></a><span class=w>    </span><span class=c1>##</span>
<a id=__codelineno-7-50 name=__codelineno-7-50 href=#__codelineno-7-50></a>
<a id=__codelineno-7-51 name=__codelineno-7-51 href=#__codelineno-7-51></a><span class=w>    </span><span class=kn>access_log</span><span class=w> </span><span class=s>/var/log/nginx/access.log</span><span class=p>;</span>
<a id=__codelineno-7-52 name=__codelineno-7-52 href=#__codelineno-7-52></a><span class=w>    </span><span class=kn>error_log</span><span class=w> </span><span class=s>/var/log/nginx/error.log</span><span class=p>;</span>
<a id=__codelineno-7-53 name=__codelineno-7-53 href=#__codelineno-7-53></a>
<a id=__codelineno-7-54 name=__codelineno-7-54 href=#__codelineno-7-54></a><span class=w>    </span><span class=c1>##</span>
<a id=__codelineno-7-55 name=__codelineno-7-55 href=#__codelineno-7-55></a><span class=w>    </span><span class=c1># Gzip Settings</span>
<a id=__codelineno-7-56 name=__codelineno-7-56 href=#__codelineno-7-56></a><span class=w>    </span><span class=c1>##</span>
<a id=__codelineno-7-57 name=__codelineno-7-57 href=#__codelineno-7-57></a>
<a id=__codelineno-7-58 name=__codelineno-7-58 href=#__codelineno-7-58></a><span class=w>    </span><span class=kn>gzip</span><span class=w> </span><span class=no>on</span><span class=p>;</span>
<a id=__codelineno-7-59 name=__codelineno-7-59 href=#__codelineno-7-59></a>
<a id=__codelineno-7-60 name=__codelineno-7-60 href=#__codelineno-7-60></a><span class=w>    </span><span class=kn>gzip_vary</span><span class=w> </span><span class=no>on</span><span class=p>;</span>
<a id=__codelineno-7-61 name=__codelineno-7-61 href=#__codelineno-7-61></a><span class=w>    </span><span class=kn>gzip_proxied</span><span class=w> </span><span class=s>any</span><span class=p>;</span>
<a id=__codelineno-7-62 name=__codelineno-7-62 href=#__codelineno-7-62></a><span class=w>    </span><span class=kn>gzip_comp_level</span><span class=w> </span><span class=mi>4</span><span class=p>;</span>
<a id=__codelineno-7-63 name=__codelineno-7-63 href=#__codelineno-7-63></a><span class=w>    </span><span class=c1># gzip_buffers 16 8k;</span>
<a id=__codelineno-7-64 name=__codelineno-7-64 href=#__codelineno-7-64></a><span class=w>    </span><span class=c1># gzip_http_version 1.1;</span>
<a id=__codelineno-7-65 name=__codelineno-7-65 href=#__codelineno-7-65></a><span class=w>    </span><span class=c1># gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;</span>
<a id=__codelineno-7-66 name=__codelineno-7-66 href=#__codelineno-7-66></a><span class=w>    </span><span class=kn>gzip_types</span><span class=w> </span><span class=s>text/plain</span><span class=w> </span><span class=s>text/css</span><span class=w> </span><span class=s>application/json</span><span class=w> </span><span class=s>application/ld+json</span><span class=w> </span><span class=s>application/x-javascript</span><span class=w> </span><span class=s>text/xml</span><span class=w> </span><span class=s>application/xml</span><span class=w> </span><span class=s>application/xml+rss</span><span class=w> </span><span class=s>text/javascript</span><span class=w> </span><span class=s>application/xml+xhtml</span><span class=w> </span><span class=s>application/javascript</span><span class=w> </span><span class=s>application/vnd.ms-fontobject</span><span class=w> </span><span class=s>font/ttf</span><span class=w> </span><span class=s>font/opentype</span><span class=w> </span><span class=s>image/svg+xml</span><span class=w> </span><span class=s>image/x-icon</span><span class=p>;</span>
<a id=__codelineno-7-67 name=__codelineno-7-67 href=#__codelineno-7-67></a>
<a id=__codelineno-7-68 name=__codelineno-7-68 href=#__codelineno-7-68></a><span class=w>    </span><span class=c1>##</span>
<a id=__codelineno-7-69 name=__codelineno-7-69 href=#__codelineno-7-69></a><span class=w>    </span><span class=c1># Virtual Host Configs</span>
<a id=__codelineno-7-70 name=__codelineno-7-70 href=#__codelineno-7-70></a><span class=w>    </span><span class=c1>##</span>
<a id=__codelineno-7-71 name=__codelineno-7-71 href=#__codelineno-7-71></a>
<a id=__codelineno-7-72 name=__codelineno-7-72 href=#__codelineno-7-72></a><span class=w>    </span><span class=kn>include</span><span class=w> </span><span class=s>/etc/nginx/conf.d/*.conf</span><span class=p>;</span>
<a id=__codelineno-7-73 name=__codelineno-7-73 href=#__codelineno-7-73></a><span class=w>    </span><span class=kn>include</span><span class=w> </span><span class=s>/etc/nginx/sites-enabled/*</span><span class=p>;</span>
<a id=__codelineno-7-74 name=__codelineno-7-74 href=#__codelineno-7-74></a><span class=p>}</span>
</code></pre></div> </details> <!-- markdownlint-enable --> <p>Évidemment, ce fichier n'est pas à recopier tel quel, mais il y a tout de même certains points importants à conserver :</p> <ul> <li><code>user</code> qui sera l'utilisateur qui exécutera les instances nginx</li> <li><code>worker_processes</code> qui définira combien d'instances seront exécutées en simultanées (Ce nombre doit correspondre au nombre de coeurs <code>logiques</code> dont dispose votre CPU). Vous pouvez disposez de cette information via la commande <em>nproc</em>. La valeur <code>auto</code> est censée définir le bon nombre de workers automatiquement</li> <li><code>include</code> qui permet d'inclure différents éléments de configuration à votre <code>nginx.conf</code> afin de rendre celui-ci plus clair. Nous pouvons voir dans notre exemple que nos sites se trouvent dans le répertoire <em>sites-enabled</em> et que certains éléments de configuration se trouvent dans le répertoire //conf.d/static/ //</li> <li><code>server_tokens</code> une valeur très importante, celle-ci doit être mise à <code>off</code>. Cette valeur évite à nginx de montrer des éléments importants tel que son numéro de version. Ces éléments peuvent être utilisés pour exploiter des failles sur nginx</li> <li><code>ignore_invalid_headers</code> est également une directive assez intéréssante. Si des bots tentent de se connecter avec un header incorrect, nginx leur retourne une erreur 404.</li> <li><code>resolver</code> nous permet de spécifier les DNS qui vont être utilisés dans les logs pour résoudre les différents noms de domaines</li> </ul> <p>La directive <em>more_set_headers</em> permet de ne pas dévoiler son serveur web, et n'est disponible que via le package <strong>nginx-extras</strong></p> <p>Comme vous pouvez le voir, on inclut également différents fichiers, les voici :</p> <details class=example> <summary>File: /etc/nginx/conf.d/filecache.conf</summary> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=c1>##</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=c1># File Cache</span>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=c1>##</span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=k>open_file_cache</span><span class=w>          </span><span class=s>max=10000</span><span class=w> </span><span class=s>inactive=20s</span><span class=p>;</span>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=k>open_file_cache_valid</span><span class=w>    </span><span class=s>60s</span><span class=p>;</span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=k>open_file_cache_min_uses</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=k>open_file_cache_errors</span><span class=w>   </span><span class=no>on</span><span class=p>;</span>
</code></pre></div> </details> <details class=example> <summary>File: /etc/nginx/conf.d/gzip.conf</summary> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=c1>###</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=c1># GZip Settings</span>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=c1>###</span>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=k>gzip</span><span class=w> </span><span class=no>on</span><span class=p>;</span>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=k>gzip_buffers</span><span class=w> </span><span class=mi>16</span><span class=w> </span><span class=mi>8k</span><span class=p>;</span>
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=k>gzip_comp_level</span><span class=w> </span><span class=mi>9</span><span class=p>;</span>
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=k>gzip_disable</span><span class=w> </span><span class=s>&quot;msie6&quot;</span><span class=p>;</span>
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=k>gzip_min_length</span><span class=w> </span><span class=mi>20</span><span class=p>;</span>
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=k>gzip_proxied</span><span class=w> </span><span class=s>any</span><span class=p>;</span>
<a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=k>gzip_types</span><span class=w> </span><span class=s>text/plain</span>
<a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=w>           </span><span class=s>text/css</span>
<a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=w>           </span><span class=s>text/xml</span>
<a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=w>           </span><span class=s>text/javascript</span>
<a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=w>           </span><span class=s>application/json</span>
<a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a><span class=w>           </span><span class=s>application/x-javascript</span>
<a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a><span class=w>           </span><span class=s>application/javascript</span>
<a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a><span class=w>           </span><span class=s>application/xml</span>
<a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a><span class=w>           </span><span class=s>application/xml+rss</span>
<a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a><span class=s>gzip_vary</span><span class=w> </span><span class=no>on</span><span class=p>;</span>
</code></pre></div> </details> <p>Ce fichier est assez important, il permet d'activer la compression <strong>gzip</strong>, ce qui signifie concrètement un gain de vitesse sur votre site internet.</p> <ul> <li><code>gzip</code> permet d'activer la compression gzip</li> <li><code>gzip_buffers</code> permet de spécifier le nombre de buffers qui vont être utilisés, ainsi que leur taille</li> <li><code>gzip_comp_level</code> spécifie lagressivité de la compression gzip. <code>Attention</code> plus la compression gzip sera forte (9), plus le CPU va être sollicité.</li> <li><code>gzip_disable</code> permet de désactiver la compression GZip selon l'User-Agent (Par exemple, ici, nous désactivons la compression gzip pour <code>IE4 à IE6</code>)</li> <li><code>gzip_min_length</code> spécifie quelle est la longueur minimale d'un élément qui doit être '"gzippé'". Il dépend du header <em>Content-Length</em></li> <li><code>gzip_proxied</code> spécifie les éléments qui doivent être '"gzippé'" lorsque nginx agit comme reverse-proxy</li> <li><code>gzip_types</code> est également une autre ligne importante. C'est ici que l'on doit spécifié les <code>MIME-Types</code> des différents éléments qui vont être '"gzippés'"</li> <li><code>gzip_vary</code> indique si un ajout va être effectué dans le header si le fichier a été '"gzippé'"</li> </ul> <!-- markdownlint-disable --> <details class=example> <summary>File: /etc/nginx/snippets/ssl.conf</summary> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=c1>###</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=c1># SSL Settings</span>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=c1>###</span>
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=c1># Ciphers for OpenSSL 1.1.1d (Bullseye)</span>
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=k>ssl_ciphers</span><span class=w> </span><span class=s>ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DHE-RSA-CHACHA20-POLY1305:DH+AES:RSA+AESGCM:RSA+AES:!aNULL:!MD5:!DSS</span><span class=p>;</span>
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=k>ssl_prefer_server_ciphers</span><span class=w> </span><span class=no>off</span><span class=p>;</span>
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=k>ssl_dhparam</span><span class=w> </span><span class=s>/etc/nginx/ssl/dhparam.pem</span><span class=p>;</span>
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>
<a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=k>ssl_prefer_server_ciphers</span><span class=w>  </span><span class=no>on</span><span class=p>;</span>
<a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=k>ssl_session_cache</span><span class=w>    </span><span class=s>shared:SSL:64m</span><span class=p>;</span><span class=w> </span><span class=c1># a 1mb cache can hold about 4000 sessions, so we can hold 40000 sessions</span>
<a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class=k>ssl_session_timeout</span><span class=w>  </span><span class=s>12h</span><span class=p>;</span>
<a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=k>ssl_session_tickets</span><span class=w>  </span><span class=no>off</span><span class=p>;</span>
<a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a>
<a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a><span class=k>add_header</span><span class=w> </span><span class=s>Strict-Transport-Security</span><span class=w> </span><span class=s>&quot;max-age=15768000</span><span class=p>;</span><span class=k>&quot;</span><span class=p>;</span>
<a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=k>add_header</span><span class=w> </span><span class=s>X-Frame-Options</span><span class=w> </span><span class=s>SAMEORIGIN</span><span class=p>;</span>
<a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class=k>add_header</span><span class=w> </span><span class=s>X-Content-Type-Options</span><span class=w> </span><span class=s>nosniff</span><span class=p>;</span>
<a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class=k>add_header</span><span class=w> </span><span class=s>X-XSS-Protection</span><span class=w> </span><span class=s>&quot;1</span><span class=p>;</span><span class=w> </span><span class=k>mode=block&quot;</span><span class=p>;</span>
<a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a><span class=k>add_header</span><span class=w> </span><span class=s>Referrer-Policy</span><span class=w> </span><span class=s>&quot;no-referrer&quot;</span><span class=p>;</span>
<a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a>
<a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a><span class=k>ssl_certificate</span><span class=w> </span><span class=s>/etc/nginx/ssl/server.crt</span><span class=p>;</span>
<a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a><span class=k>ssl_certificate_key</span><span class=w> </span><span class=s>/etc/nginx/ssl/server.key</span><span class=p>;</span>
</code></pre></div> </details> <!-- markdownlint-enable --> <p>Le fichier <strong>ssl.conf</strong> est à inclure seulement si l'on souhaite du SSL sur ses sites web</p> <p>Certaines lignes sont importantes tels que <strong>ssl_ciphers</strong> qui permet de sélectionner quels ciphers seront utilisés pour coder l'échange entre son serveur web, et son client. Cette ligne est extrêmement importante car il y a actuellement de nombreux ciphers utilisés mais qui sont totalement dépassés. <strong>ssl_protocols</strong> permet lui également de ne pas passés par des protocoles complètement troués. Cependant, il faut faire attention avec ces 2 lignes, car en effet, elles peuvent provoquer des <strong>erreurs de sécurité côté navigateur</strong>, voir carrément entrainer <strong>un refus du navigateur</strong>. Nous activons également le protocole <strong>HSTS</strong> (Plus d'informations <a href="http://www.bortzmeyer.org/6797.html">ici</a>)</p> <p>Pour avoir une bonne cipher list, et de bons paramètres SSL, je vous recommande d'aller voir le <a href="https://wiki.mozilla.org/Security/Server_Side_TLS">Wiki Mozilla</a></p> <p>Je n'ai volontairement pas mis une configuration CSP (Content Security Protocol) car il s'agit d'un protocole délicat à mettre en place, et je vous renvoie vers l'<a href="https://content-security-policy.com/">article de préférence</a></p> <p>Voici désormais des snippets utiles pour ses différents blocks nginx :</p> <!-- markdownlint-disable --> <details class=example> <summary>File: /etc/nginx/snippets/protect.conf</summary> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=c1>###</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=c1># Basic File Protect</span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=c1>###</span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=c1># Disallow download of hidden files</span>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=k>location</span><span class=w> </span><span class=p>~</span><span class=sr>*</span><span class=w> </span><span class=s>(?:^|/)&#39;.</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=w>    </span><span class=kn>deny</span><span class=w> </span><span class=s>all</span><span class=p>;</span>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=p>}</span>
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=c1># Disallow download of these extensions</span>
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=k>location</span><span class=w> </span><span class=p>~</span><span class=sr>*</span><span class=w> </span><span class=s>(?:&#39;.(?:bak|conf.*|sql|fla|psd|ini|log|sh|inc|swp|dist)|~)</span>$<span class=w> </span><span class=p>{</span>
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=w>    </span><span class=kn>deny</span><span class=w> </span><span class=s>all</span><span class=p>;</span>
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a><span class=p>}</span>
</code></pre></div> </details> <!-- markdownlint-enable --> <p>Ce fichier nous permet d'éviter que des fichiers de configuration ou autres soient accessible par tout le monde. Il s'agit d'un fichier générique qui s'adapte au plus grand nombre de services, évidemment, il se peut que certains fichiers/dossiers ne soient pas protégés, dans ces cas-là, il faut les ajouter manuellement.</p> <h3 id=snippets>Snippets</h3> <p>Snippets utiles pour vos vhosts (snippets/letsencrypt.conf)</p> <!-- markdownlint-disable --> <details class=example> <summary>File: /etc/nginx/snippets/letsencrypt.conf</summary> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=k>location</span><span class=w> </span><span class=s>^~</span><span class=w> </span><span class=s>/.well-known/acme-challenge/</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=w>    </span><span class=kn>satisfy</span><span class=w> </span><span class=s>any</span><span class=p>;</span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=w>    </span><span class=kn>allow</span><span class=w> </span><span class=s>all</span><span class=p>;</span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=w>    </span><span class=kn>access_log</span><span class=w> </span><span class=s>/var/log/nginx/certbot.log</span><span class=p>;</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=w>    </span><span class=kn>root</span><span class=w> </span><span class=s>/var/www/letsencrypt</span><span class=p>;</span>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=p>}</span>
</code></pre></div> </details> <!-- markdownlint-enable --> <h2 id=installer-et-configurer-php7-fpm>Installer et configurer PHP7-FPM</h2> <p>Commande à adapter selon les modules que vous souhaitez. Généralement, ces derniers sont suffisant pour 99% des installations.</p> <!-- markdownlint-disable MD013 --> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>apt-get<span class=w> </span>-y<span class=w> </span>install<span class=w> </span>php-common<span class=w> </span>php8.2<span class=w> </span>php8.2-bz2<span class=w> </span>php8.2-cli<span class=w> </span>php8.2-common<span class=w> </span>php8.2-curl<span class=w> </span>php8.2-fpm<span class=w> </span>php8.2-gd<span class=w> </span>php8.2-geoip<span class=w> </span>php8.2-gmp<span class=w> </span>php8.2-igbinary<span class=w> </span>php8.2-imagick<span class=w> </span>php8.2-intl<span class=w> </span>php8.2-json<span class=w> </span>php8.2-mbstring<span class=w> </span>php8.2-mcrypt<span class=w> </span>php8.2-memcached<span class=w> </span>php8.2-msgpack<span class=w> </span>php8.2-mysql<span class=w> </span>php8.2-opcache<span class=w> </span>php8.2-readline<span class=w> </span>php8.2-sqlite3<span class=w> </span>php8.2-xml<span class=w> </span>php8.2-xmlrpc<span class=w> </span>php8.2-zip
</code></pre></div> <p>Nous allons maintenant passer à la configuration de base de <strong>PHP-FPM</strong>, tout se situe dans le répertoire /etc/php/8.2/fpm/ et ses sous-répertoires. (8.2 a remplacer par votre numéro de version)</p> <p>Nous allons éditer le fichier php.ini :</p> <ul> <li><code>expose_php</code> : Désactivation afin de ne pas exposer la version de PH</li> <li><code>upload_max_filesize</code> : Modification de la taille maximale des fichiers qu'on peut upload avec PHP</li> <li><code>post_max_size</code> : Va avec la directive <em>upload_max_filesize</em> et doit être supérieur à cette dernière</li> <li><code>max_file_uploads</code> : Nombre de fichiers qu'on peut upload en parallèle. Par défaut à 20, peut suffir dans une majorité des cas</li> </ul> <p>Petit customisation de la. configuration afin d'optimiser les performances. Il faut pour la plupart des CMS/Framework adapter les valeurs de l'OPcache. Pour WordPress, voici des valeurs adéquates :</p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>opcache.memory_consumption<span class=w> </span><span class=o>=</span><span class=w> </span>128M
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>opcache.interned_strings_buffer<span class=o>=</span><span class=m>16</span>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>opcache.max_accelerated_files<span class=o>=</span><span class=m>100000</span>
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>opcache.fast_shutdown<span class=o>=</span><span class=m>1</span>
</code></pre></div> <p>Symfony fournit ses <a href="https://symfony.com/doc/current/performance.html#configure-opcache-for-maximum-performance">propres recommandations</a> pour la configuration de l'OPcache. La variable <em>opcache.max_accelerated_files</em> peut être facilement calculée :</p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>└─#<span class=w> </span>find<span class=w> </span>.<span class=w> </span>-name<span class=w> </span><span class=s2>&quot;*.php&quot;</span><span class=w> </span><span class=p>|</span>wc<span class=w> </span>-l
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=m>5165</span>
</code></pre></div> <p>Pour notre exemple, 10000 fichiers sont largement suffiants. Aucune astuce existe pour calculer <em>opcache.memory_consumption</em>. Il faudra surveiller votre monitoring.</p> <h2 id=installer-et-configurer-mariadb>Installer et configurer MariaDB</h2> <p>On met à jour les paquets disponibles :</p> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>apt-get<span class=w> </span>update
</code></pre></div> <p>Et enfin, on vérifie que la <em>Candidate Version</em> est la bonne :</p> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>apt-cache<span class=w> </span>policy<span class=w> </span>mariadb-server
</code></pre></div> <p>Voilà le résultat attendu :</p> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>$<span class=w> </span>apt-cache<span class=w> </span>policy<span class=w> </span>mariadb-server
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>mariadb-server:
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=w>  </span>Installé<span class=w> </span>:<span class=w> </span><span class=o>(</span>aucun<span class=o>)</span>
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=w>  </span>Candidat<span class=w> </span>:<span class=w> </span><span class=m>1</span>:10.3.29-0+deb10u1
<a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=w> </span>Table<span class=w> </span>de<span class=w> </span>version<span class=w> </span>:
<a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=w> </span>***<span class=w> </span><span class=m>1</span>:10.3.29-0+deb10u1<span class=w> </span><span class=m>500</span>
<a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=w>        </span><span class=m>500</span><span class=w> </span>http://apt.daevel.fr/debian<span class=w> </span>buster/main<span class=w> </span>amd64<span class=w> </span>Packages
<a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=w>        </span><span class=m>100</span><span class=w> </span>/var/lib/dpkg/status
</code></pre></div> <p>Si tout se passe comme il faut, on lance l'installation du serveur SQL</p> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a>apt-get<span class=w> </span>install<span class=w> </span>mariadb-server
</code></pre></div> <p>Pendant l'installation de <strong>mariadb-server</strong>, vous allez obtenir une fenêtre vous demandant de spécifier un password</p> <p>Cette fenêtre est <strong>très importante</strong>, elle va vous permettre de définir votre <strong>root password</strong> pour gérer vos bases de données, il faut utiliser un mot de passe relativement puissant pour qu'il ne puisse pas être découvert ou cracké, sans quoi, tous vos sites sont à nus.</p> <p>Et on finit par le script made in MariaDB pour sécuriser le tout</p> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a>mysql_secure_installation
</code></pre></div> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Dernière mise à jour"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="21 février 2026 22:48:53 UTC">21 février 2026</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Créé> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="6 juin 2022 18:32:45 UTC">6 juin 2022</span> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Retour en haut de la page </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> </div> <div class=md-social> <a href="https://twitter.com/Pixel__Art" target="_blank" rel="noopener" title="twitter.com" class="md-social__link"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg> </a> <a href="https://github.com/PixiBixi" target="_blank" rel="noopener" title="github.com" class="md-social__link"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href="https://fr.linkedin.com/in/je-delgado" target="_blank" rel="noopener" title="fr.linkedin.com" class="md-social__link"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["toc.integrate", "header.autohide", "navigation.tracking", "navigation.instant", "navigation.tabs", "navigation.sections", "navigation.prune", "navigation.top", "content.code.copy", "search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version": "S\u00e9lectionner la version"}, "version": null}</script> <script src=../../../assets/javascripts/bundle.92b07e13.min.js></script> <script id=init-glightbox>document.querySelectorAll('.glightbox').forEach(function(element) {
    try {
        var img = element.querySelector('img');
        if (img && img.src) {
            element.setAttribute('href', img.src);
        } else {
            console.log('No img element with src attribute found');
        }
    } catch (error) {
        console.log('Error:', error);
    }
});
const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body> </html>